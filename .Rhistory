colnames(lab)<-"Label"
# lab$Label<- factor(lab$Label,levels = c("Control","Hyperglutamatergic","Hypoglutamatergic"),ordered = TRUE)
lab$Label<- factor(lab$Label,levels = c("Control","Hypoglutamatergic"),ordered = TRUE)
mat_allg <- apply(mat_allg[-1,],c(1,2),as.numeric)
# lc <- c("#95C65C","#B25D91","#FF3F38")
# names(lc) <-  levels(lab$Label)
# lc <- list(Label = lc)
lc <- c("#95C65C","#FF3F38")
names(lc) <-  levels(lab$Label)
lc <- list(Label = lc)
p5 <- pheatmap(mat_allg, annotation = lab,clustering_method = "ward.D2",fontsize = 10,show_colnames = TRUE,show_rownames = FALSE, border_color = NA, annotation_colors = lc, color = colorRampPalette(c("blue","red"))(100), cluster_rows = TRUE,scale = "row",legend = TRUE, annotation_legend = TRUE, cellwidth = 10, cellheight = 2)
p5 <- wrap_elements(as.grob(p5))
patchhc1 <- p6 + p5 + plot_annotation(tag_levels = list(c("E","F")))
ggsave(file=here("paper/Figures/fig_1E_F.png"),patchhc1,dpi = 1000,scale=1.5,width = 8, height = 3, units = "in")
# plot(pd_g$Hypoglutamatergic,typeVc ="x-score",plotSubC="Hypoglutamatergic",parPaletteVc=c("#95C65C","#B25D91"))
# plot(pd_g$`Hyperglutamatergic`,typeVc ="x-score",plotSubC="Hypoglutamatergic",parPaletteVc=c("#95C65C","#FF3F38"))
rt <- gsub("10", "Hyperglutamatergic", subset(df_norm_lab4,Label%in%c(1,10))$Label)
rt <- gsub("1", "Control", rt)
rt <- factor(rt,levels = c("Control","Hyperglutamatergic","Hypoglutamatergic"))
gr <- gsub("8", "Hypoglutamatergic", subset(df_norm_lab4,Label%in%c(1,8))$Label)
gr <- gsub("1", "Control", gr)
gr <- factor(gr,levels = c("Control","Hyperglutamatergic","Hypoglutamatergic"))
opdf <- data.frame("lab"=rt,"x"=pd_g$Hyperglutamatergic@scoreMN,"y"=pd_g$Hyperglutamatergic@orthoScoreMN)
opdf2 <- data.frame("lab"=gr,"x"=pd_g$`Hypoglutamatergic`@scoreMN,"y"=pd_g$`Hypoglutamatergic`@orthoScoreMN)
# par(mfrow=c(1,2))
two_a <- opdf %>%
ggplot(aes(x=p1,y=o1,color=lab)) +
geom_point(size=3) +
stat_ellipse(geom = "polygon",
aes(fill = lab),
alpha = 0.25,
level = 0.8) +
coord_fixed(xlim = c(-10,10),ylim=c(-5,5)) +
theme_bw(base_size = 15) +
# ggtitle(paste("OPLS-DA", "SCORE PLOT ",collapse="\n")) +
scale_color_manual(values=c("#95C65C","#B25D91","#FF3F38"),labels=c("Control","Hyperglutamatergic","Hypoglutamatergic"),drop = FALSE) +
scale_fill_manual(values=c("#95C65C","#B25D91","#FF3F38"),labels=c("Control","Hyperglutamatergic","Hypoglutamatergic"),drop = FALSE) +
theme(legend.title = element_blank()) +
geom_vline(xintercept=0) +
geom_hline(yintercept = 0)
two_b <- opdf2 %>%
ggplot(aes(x=p1,y=o1,color=lab)) +
geom_point(size=3) +
stat_ellipse(geom = "polygon",
aes(fill = lab),
alpha = 0.25,
level = 0.8) +
coord_fixed(xlim = c(-10,10),ylim=c(-5,5)) +
theme_bw(base_size = 15) +
# ggtitle(paste("OPLS-DA", "SCORE PLOT ",collapse="\n")) +
scale_color_manual(values=c("#95C65C","#B25D91","#FF3F38"),drop = FALSE) +
scale_fill_manual(values=c("#95C65C","#B25D91","#FF3F38"),drop = FALSE) +
theme(legend.title = element_blank()) +
geom_vline(xintercept=0) +
geom_hline(yintercept = 0)
patchop <- two_a   + two_b + plot_annotation(tag_levels = "A")  + plot_layout(guides = "collect") & theme(legend.position = 'right')
ggsave(file=here("paper/Figures/fig_2A_B.png"),patchop,dpi = 500,width = 8, height = 3, units = "in")
df_metg <- df_norm_lab4[,c("rowname","Label",(sels$Hyperglutamatergic))]
df_metg <- column_to_rownames(df_metg,"rowname")
df_metg <- subset(df_metg,Label%in%c(1,10))
df_metg <- data.frame(t(df_metg),check.names = FALSE)
mat_allg <- as.matrix(df_metg)
lab <- data.frame(as.factor(mat_allg[1,]))
lab$as.factor.mat_allg.1.... <- gsub(10,"Hyperglutamatergic     ",lab$as.factor.mat_allg.1....)
lab$as.factor.mat_allg.1.... <- gsub(1,"Control",lab$as.factor.mat_allg.1....)
colnames(lab)<-"Label"
# lab$Label<- factor(lab$Label,levels = c("Control","Hyperglutamatergic","Hypoglutamatergic"),ordered = TRUE)
lab$Label<- factor(lab$Label,levels = c("Control","Hyperglutamatergic     ","Hypoglutamatergic     "),ordered = TRUE)
mat_allg <- apply(mat_allg[-1,],c(1,2),as.numeric)
# lc <- c("#95C65C","#B25D91","#FF3F38")
# names(lc) <-  levels(lab$Label)
# lc <- list(Label = lc)
lc <- c("#95C65C","#B25D91","#FF3F38")
names(lc) <-  levels(lab$Label)
lc <- list(Label = lc)
p6 <- pheatmap(mat_allg, annotation = lab,clustering_method = "ward.D2",fontsize = 10,show_colnames = TRUE,show_rownames = TRUE, border_color = NA, annotation_colors = lc, fontsize_col = 10, color = colorRampPalette(c("blue","red"))(100), cluster_rows = TRUE,scale = "row",legend = FALSE, annotation_legend = FALSE, cellwidth = 12, cellheight = 9)
ggsave(file=here("paper/Figures/fig_2G.png"),p6,dpi = 500,width = 4,scale=2, height = 3, units = "in")
# p6 <- wrap_elements(as.grob(p6))
df_metg <- df_norm_lab4[,c("rowname","Label",(sels$Hypoglutamatergic))]
df_metg <- column_to_rownames(df_metg,"rowname")
df_metg <- subset(df_metg,Label%in%c(1,8))
df_metg <- data.frame(t(df_metg),check.names = FALSE)
mat_allg <- as.matrix(df_metg)
lab <- data.frame(as.factor(mat_allg[1,]))
lab$as.factor.mat_allg.1.... <- gsub(8,"Hyperglutamatergic     ",lab$as.factor.mat_allg.1....)
lab$as.factor.mat_allg.1.... <- gsub(1,"Control",lab$as.factor.mat_allg.1....)
colnames(lab)<-"Label"
# lab$Label<- factor(lab$Label,levels = c("Control","Hyperglutamatergic","Hypoglutamatergic"),ordered = TRUE)
lab$Label<- factor(lab$Label,levels = c("Control","Hyperglutamatergic     ","Hypoglutamatergic     "),ordered = TRUE)
mat_allg <- apply(mat_allg[-1,],c(1,2),as.numeric)
# lc <- c("#95C65C","#B25D91","#FF3F38")
# names(lc) <-  levels(lab$Label)
# lc <- list(Label = lc)
lc <- c("#95C65C","#FF3F38","#B25D91")
names(lc) <-  levels(lab$Label)
lc <- list(Label = lc)
p7 <- pheatmap(mat_allg, annotation = lab,clustering_method = "ward.D2",fontsize = 12,show_colnames = TRUE,show_rownames = TRUE, border_color = NA, annotation_colors = lc, fontsize_col = 12, color = colorRampPalette(c("blue","red"))(100), cluster_rows = TRUE,scale = "row",legend = TRUE, annotation_legend = FALSE, cellwidth = 15, cellheight = 10)
p7 <- wrap_elements(as.grob(p7))
ggsave(file=here("paper/Figures/fig_2H.png"),p7,dpi = 500,width = 4,scale=2, height = 3, units = "in")
patchhc2 <- wrap_elements(full=as.grob(p6)) + p7 + plot_annotation(tag_levels = list(c("G","H")), theme = theme(plot.margin = margin(t = 0.5, r = 0.5, b = 0.5, l =0.5, unit = "in")))
ggsave(file=here("paper/Figures/fig_2G_H.png"),patchhc2,dpi = 1000,width = 8,scale=2, height = 3, units = "in")
library(psych)
metdat_char <- read.csv("C:/Users/killescas/OneDrive - San Juan de Dios/Desktop/TESIS/LCR/metabolomica/meds_5h.csv",sep=";")
metdat_char <- metdat_char[complete.cases(metdat_char),]
metdat_char <- metdat_char %>%
column_to_rownames(var="ID")
contab <- table(metdat_char)
phi(contab,digits=3)
pat_contrl <-  read.csv(here("metadata/patient_characteristics.csv"),sep=";")
pat_contrl <-  pat_contrl[,-7]
pat_contrl <-  pat_contrl[order(pat_contrl$ID),]
pat_contrl <-  subset(pat_contrl,!(pat_contrl$Disease=="Control"))
df_norm_age <- df_norm_lab
df_norm_age <- rownames_to_column(df_norm_age,var = "ID")
df_norm_age <- subset(df_norm_age, make.names(df_norm_age$ID)%in%pat_contrl$ID)
df_norm_age$Label <- pat_contrl$Age
df_norm_age <- df_norm_age[complete.cases(df_norm_age),]
log_df_age <- melt(df_norm_age, id.vars = c("ID","Label"))
cor_age <- log_df_age %>%
group_by(variable) %>%
cor_test(Label, value, method= "spearman")
write.csv(cor_age,file=here("paper/Tables/correlation_age.csv"))
patchhc2
ggsave(file=here("paper/Figures/fig_2G_H.png"),patchhc2,dpi = 1000,width = 8, height = 4, units = "in")
ggsave(file=here("paper/Figures/fig_2G_H.png"),patchhc2,dpi = 1000,width = 8, height = 4, scale=2,units = "in")
ggsave(file=here("paper/Figures/fig_2G_H.png"),patchhc2,dpi = 1000,width = 6, height = 3, scale=2,units = "in")
ggsave(file=here("paper/Figures/fig_2G_H.png"),patchhc2,dpi = 1000,width = 8, height = 3, scale=2,units = "in")
ggsave(file=here("paper/Figures/fig_2G_H.png"),patchhc2,dpi = 3000,width = 8, height = 3, scale=2,units = "in")
ggsave(file=here("paper/Figures/fig_2G_H.png"),patchhc2,dpi = 2000,width = 8, height = 3, scale=2,units = "in")
ggsave(file=here("paper/Figures/fig_2G_H.png"),patchhc2,dpi = 500,width = 8, height = 3, scale=2,units = "in")
ggsave(file=here("paper/Figures/fig_2G_H.png"),patchhc2,dpi = 2000,width = 8, height = 4, scale=2,units = "in")
ggsave(file=here("paper/Figures/fig_2G_H.png"),patchhc2,dpi = 2000,width = 5, height = 4, scale=2,units = "in")
ggsave(file=here("paper/Figures/fig_2G_H.png"),patchhc2,dpi = 2000,width = 12, height = 4,units = "in")
ggsave(file=here("paper/Figures/fig_2G_H.png"),patchhc2,dpi = 2000,width = 20, height = 4,units = "in")
ggsave(file=here("paper/Figures/fig_2G_H.png"),patchhc2,dpi = 2000,width = 16, height = 8,scale=2,units = "in")
ggsave(file=here("paper/Figures/fig_2G_H.png"),patchhc2,dpi = 1000,width = 16, height = 8,scale=2,units = "in")
ggsave(file=here("paper/Figures/fig_2G_H.png"),patchhc2,dpi = 1000,width = 10, height = 5,scale=2,units = "in")
ggsave(file=here("paper/Figures/fig_2G_H.png"),patchhc2,dpi = 1000,width = 8, height = 4,scale=2,units = "in")
ggsave(file=here("paper/Figures/fig_2G_H.png"),patchhc2,dpi = 1000,width = 4, height = 2,scale=2,units = "in")
ggsave(file=here("paper/Figures/fig_2G_H.png"),patchhc2,dpi = 1000,width = 6, height = 3,scale=2,units = "in")
ggsave(file=here("paper/Figures/fig_2G_H.png"),patchhc2,dpi = 1000,width = 7, height = 3,scale=2,units = "in")
ggsave(file=here("paper/Figures/fig_2G_H.png"),patchhc2,dpi = 2000,width = 7, height = 3,scale=2,units = "in")
ggsave(file=here("paper/Figures/fig_2G_H.png"),patchhc2,dpi = 2000)
patchhc2
p6+p7
p7
p6
df_metg <- df_norm_lab4[,c("rowname","Label",(sels$Hyperglutamatergic))]
df_metg <- column_to_rownames(df_metg,"rowname")
df_metg <- subset(df_metg,Label%in%c(1,10))
df_metg <- data.frame(t(df_metg),check.names = FALSE)
mat_allg <- as.matrix(df_metg)
lab <- data.frame(as.factor(mat_allg[1,]))
lab$as.factor.mat_allg.1.... <- gsub(10,"Hyperglutamatergic     ",lab$as.factor.mat_allg.1....)
lab$as.factor.mat_allg.1.... <- gsub(1,"Control",lab$as.factor.mat_allg.1....)
colnames(lab)<-"Label"
# lab$Label<- factor(lab$Label,levels = c("Control","Hyperglutamatergic","Hypoglutamatergic"),ordered = TRUE)
lab$Label<- factor(lab$Label,levels = c("Control","Hyperglutamatergic     ","Hypoglutamatergic     "),ordered = TRUE)
mat_allg <- apply(mat_allg[-1,],c(1,2),as.numeric)
# lc <- c("#95C65C","#B25D91","#FF3F38")
# names(lc) <-  levels(lab$Label)
# lc <- list(Label = lc)
lc <- c("#95C65C","#B25D91","#FF3F38")
names(lc) <-  levels(lab$Label)
lc <- list(Label = lc)
p6 <- pheatmap(mat_allg, annotation = lab,clustering_method = "ward.D2",fontsize = 10,show_colnames = TRUE,show_rownames = TRUE, border_color = NA, annotation_colors = lc, fontsize_col = 10, color = colorRampPalette(c("blue","red"))(100), cluster_rows = TRUE,scale = "row",legend = FALSE, annotation_legend = FALSE, cellwidth = 12, cellheight = 9)
ggsave(file=here("paper/Figures/fig_2G.png"),p6,dpi = 500,width = 4,scale=2, height = 3, units = "in")
p6 <- wrap_elements(as.grob(p6))
p6+p7
# patchhc2 <- wrap_elements(full=as.grob(p6)) + p7 + , theme = theme(plot.margin = margin(t = 0.5, r = 0.5, b = 0.5, l =0.5, unit = "in")))
patchhc2 <- p6+p7+plot_annotation(tag_levels = list(c("G","H")))
ggsave(file=here("paper/Figures/fig_2G_H.png"),patchhc2,dpi = 2000)
ggsave(file=here("paper/Figures/fig_2G_H.png"),patchhc2,dpi = 2000, height = 4, width=8)
ggsave(file=here("paper/Figures/fig_2G_H.png"),patchhc2,dpi = 2000, height = 4, width=16)
ggsave(file=here("paper/Figures/fig_2G_H.png"),patchhc2,dpi = 2000, height = 8, width=16)
ggsave(file=here("paper/Figures/fig_2G_H.png"),patchhc2,dpi = 1000,scale=1.5,width = 8, height = 3,units = "in")
ggsave(file=here("paper/Figures/fig_2G_H.png"),patchhc2,dpi = 1000,scale=1.5,width = 10, height = 3,units = "in")
p6 <- pheatmap(mat_allg, annotation = lab,clustering_method = "ward.D2",fontsize = 10,show_colnames = TRUE,show_rownames = TRUE, border_color = NA, annotation_colors = lc, fontsize_col = 10, color = colorRampPalette(c("blue","red"))(100), cluster_rows = TRUE,scale = "row",legend = TRUE, annotation_legend = FALSE, cellwidth = 12, cellheight = 9)
ggsave(file=here("paper/Figures/fig_2G.png"),p6,dpi = 500,width = 4,scale=2, height = 3, units = "in")
pat_contrl <-  read.csv(here("metadata/patient_characteristics.csv"),sep=";")
pat_contrl <-  pat_contrl[,-7]
pat_contrl <-  pat_contrl[order(pat_contrl$ID),]
pat_contrl <-  subset(pat_contrl,!(pat_contrl$Disease=="Control"))
df_norm_age <- df_norm_lab
df_norm_age <- rownames_to_column(df_norm_age,var = "ID")
df_norm_age <- subset(df_norm_age, make.names(df_norm_age$ID)%in%pat_contrl$ID)
df_norm_age$Label <- pat_contrl$Age
df_norm_age <- df_norm_age[complete.cases(df_norm_age),]
log_df_age <- melt(df_norm_age, id.vars = c("ID","Label"))
cor_age <- log_df_age %>%
group_by(variable) %>%
cor_test(Label, value, method= "spearman")
write.csv(cor_age,file=here("paper/Tables/correlation_age.csv"))
pat_contrl <-  read.csv(here("metadata/patient_characteristics.csv"),sep=";")
pat_contrl <-  pat_contrl[,-7]
pat_contrl <-  pat_contrl[order(pat_contrl$ID),]
pat_contrl <-  subset(pat_contrl,!(pat_contrl$Disease=="Control"))
df_norm_sex <- df_norm_lab
df_norm_sex <- rownames_to_column(df_norm_sex,var = "ID")
df_norm_sex <- subset(df_norm_sex, make.names(df_norm_sex$ID)%in%pat_contrl$ID)
df_norm_sex$Label <- pat_contrl$Sex
df_norm_sex <- df_norm_sex[complete.cases(df_norm_sex),]
log_df_sex <- melt(df_norm_sex, id.vars = c("ID","Label"))
cor_sex <- log_df_sex %>%
group_by(variable) %>%
cor_test(Label, value, method= "spearman")
log_df_sex
pat_contrl <-  read.csv(here("metadata/patient_characteristics.csv"),sep=";")
pat_contrl <-  pat_contrl[,-7]
pat_contrl <-  pat_contrl[order(pat_contrl$ID),]
pat_contrl <-  subset(pat_contrl,!(pat_contrl$Disease=="Control"))
df_norm_sex <- df_norm_lab
df_norm_sex <- rownames_to_column(df_norm_sex,var = "ID")
df_norm_sex <- subset(df_norm_sex, make.names(df_norm_sex$ID)%in%pat_contrl$ID)
df_norm_sex$Label <- as.factor(pat_contrl$Sex)
df_norm_sex <- df_norm_sex[complete.cases(df_norm_sex),]
log_df_sex <- melt(df_norm_sex, id.vars = c("ID","Label"))
cor_sex <- log_df_sex %>%
group_by(variable) %>%
cor_test(Label, value, method= "spearman")
log_df_sex
cor_sex <- log_df_sex %>%
group_by(variable) %>%
cor_test(Label, value, method= "spearman")
log_df_sex
df_norm_sex$Label <- ifelse(pat_contrl$Sex=="F",1,0)
df_norm_sex
pat_contrl
pat_contrl <-  read.csv(here("metadata/patient_characteristics.csv"),sep=";")
pat_contrl <-  pat_contrl[,-7]
pat_contrl <-  pat_contrl[order(pat_contrl$ID),]
pat_contrl <-  subset(pat_contrl,!(pat_contrl$Disease=="Control"))
df_norm_sex <- df_norm_lab
df_norm_sex <- rownames_to_column(df_norm_sex,var = "ID")
df_norm_sex <- subset(df_norm_sex, make.names(df_norm_sex$ID)%in%pat_contrl$ID)
df_norm_sex$Label <- ifelse(pat_contrl$Sex=="F",1,0) #Female is 1
df_norm_sex <- df_norm_sex[complete.cases(df_norm_sex),]
log_df_sex <- melt(df_norm_sex, id.vars = c("ID","Label"))
cor_sex <- log_df_sex %>%
group_by(variable) %>%
cor_test(Label, value, method= "spearman")
cor_sex
View(cor_sex)
?kruskal_test
comp_sex <- log_df_sex %>%
group_by(variable) %>%
kruskal_test(value ~ Label)
View(comp_sex)
?wilcox_test
comp_sex <- log_df_sex %>%
group_by(variable) %>%
wilcox_test(value ~ Label,p.adjust.method = "fdr")
View(comp_sex)
comp_sex <- log_df_sex %>%
group_by(variable) %>%
wilcox_test(value ~ Label)
View(comp_sex)
comp_sex <- log_df_sex %>%
group_by(variable) %>%
wilcox_test(value ~ Label) %>%
adjust_pvalue(method = "bonferroni") %>%
add_significance("p.adj")
View(comp_sex)
pat_contrl <-  read.csv(here("metadata/patient_characteristics.csv"),sep=";")
pat_contrl <-  pat_contrl[,-7]
pat_contrl <-  pat_contrl[order(pat_contrl$ID),]
pat_contrl <-  subset(pat_contrl,!(pat_contrl$Disease=="Control"))
df_norm_sex <- df_norm_lab
df_norm_sex <- rownames_to_column(df_norm_sex,var = "ID")
df_norm_sex <- subset(df_norm_sex, make.names(df_norm_sex$ID)%in%pat_contrl$ID)
df_norm_sex$Label <- factor(pat_contrl$Sex=="F")
df_norm_sex <- df_norm_sex[complete.cases(df_norm_sex),]
log_df_sex <- melt(df_norm_sex, id.vars = c("ID","Label"))
cor_sex <- log_df_sex %>%
group_by(variable) %>%
cor_test(Label, value, method= "spearman")
comp_sex <- log_df_sex %>%
group_by(variable) %>%
wilcox_test(value ~ Label) %>%
adjust_pvalue(method = "bonferroni") %>%
add_significance("p.adj")
View(comp_sex)
pat_contrl <-  read.csv(here("metadata/patient_characteristics.csv"),sep=";")
pat_contrl <-  pat_contrl[,-7]
pat_contrl <-  pat_contrl[order(pat_contrl$ID),]
pat_contrl <-  subset(pat_contrl,!(pat_contrl$Disease=="Control"))
df_norm_sex <- df_norm_lab
df_norm_sex <- rownames_to_column(df_norm_sex,var = "ID")
df_norm_sex <- subset(df_norm_sex, make.names(df_norm_sex$ID)%in%pat_contrl$ID)
df_norm_sex$Label <- factor(pat_contrl$Sex)
df_norm_sex <- df_norm_sex[complete.cases(df_norm_sex),]
log_df_sex <- melt(df_norm_sex, id.vars = c("ID","Label"))
comp_sex <- log_df_sex %>%
group_by(variable) %>%
wilcox_test(value ~ Label) %>%
adjust_pvalue(method = "bonferroni") %>%
add_significance("p.adj")
View(comp_sex)
comp_sex <- log_df_sex %>%
group_by(variable) %>%
wilcox_test(value ~ Label) %>%
adjust_pvalue(method = "fdr") %>%
add_significance("p.adj")
View(comp_sex)
cor_age <- log_df_age %>%
group_by(variable) %>%
cor_test(Label, value, method= "spearman")  %>%
adjust_pvalue(method = "fdr") %>%
add_significance("p.adj")
write.csv(comp_sex,file=here("paper/Tables/comparing_sex.csv"))
df_norm_sex
opls(df_norm_sex[,-c(1,2)],as.factor(df_norm_sex$Label),orthoI = 1,predI=1,scaleC = "center", permI = 1000)
oplsda_sex <- opls(df_norm_sex[,-c(1,2)],as.factor(df_norm_sex$Label),orthoI = 1,predI=1,scaleC = "center", permI = 1000)
oplsda_age <- opls(df_norm_age[,-c(1,2)],as.factor(df_norm_age$Label),orthoI = 1,predI=1,scaleC = "center", permI = 1000)
pat_contrl <-  read.csv(here("metadata/patient_characteristics.csv"),sep=";")
pat_contrl <-  pat_contrl[,-7]
pat_contrl <-  pat_contrl[order(pat_contrl$ID),]
pat_contrl <-  subset(pat_contrl,!(pat_contrl$Disease=="Control"))
df_norm_age <- df_norm_lab
df_norm_age <- rownames_to_column(df_norm_age,var = "ID")
df_norm_age <- subset(df_norm_age, make.names(df_norm_age$ID)%in%pat_contrl$ID)
df_norm_age$Label <- pat_contrl$Age
df_norm_age <- df_norm_age[complete.cases(df_norm_age),]
log_df_age <- melt(df_norm_age, id.vars = c("ID","Label"))
cor_age <- log_df_age %>%
group_by(variable) %>%
cor_test(Label, value, method= "spearman")  %>%
adjust_pvalue(method = "fdr") %>%
add_significance("p.adj")
write.csv(cor_age,file=here("paper/Tables/correlation_age.csv"))
pat_contrl <-  read.csv(here("metadata/patient_characteristics.csv"),sep=";")
pat_contrl <-  pat_contrl[,-7]
pat_contrl <-  pat_contrl[order(pat_contrl$ID),]
pat_contrl <-  subset(pat_contrl,!(pat_contrl$Disease=="Control"))
df_norm_sex <- df_norm_lab
df_norm_sex <- rownames_to_column(df_norm_sex,var = "ID")
df_norm_sex <- subset(df_norm_sex, make.names(df_norm_sex$ID)%in%pat_contrl$ID)
df_norm_sex$Label <- factor(pat_contrl$Sex)
df_norm_sex <- df_norm_sex[complete.cases(df_norm_sex),]
log_df_sex <- melt(df_norm_sex, id.vars = c("ID","Label"))
comp_sex <- log_df_sex %>%
group_by(variable) %>%
wilcox_test(value ~ Label) %>%
adjust_pvalue(method = "fdr") %>%
add_significance("p.adj")
write.csv(comp_sex,file=here("paper/Tables/comparing_sex.csv"))
oplsda_sex <- opls(df_norm_sex[,-c(1,2)],as.factor(df_norm_sex$Label),orthoI = 1,predI=1,scaleC = "center", permI = 1000)
?stat_summary
lcp3 <- c("#FF3F38","#B25D91","#95C65C")
df_norm_lab4 <- df_norm_lab
df_norm_lab4$Label <- ifelse(df_norm_lab4$Label==2,10,df_norm_lab4$Label)
df_norm_lab4$Label <- ifelse(df_norm_lab4$Label==12,8,df_norm_lab4$Label)
df_norm_lab4 <- rownames_to_column(df_norm_lab4)
log_df1 <- melt(df_norm_lab4, id.vars=c("rowname","Label"))
ex_df1 <- log_df1
ex_df1$value <- exp(ex_df1$value)
ex_df1$value <-as.numeric(format(ex_df1$value, scientific = FALSE))
ex_df1$Label <- factor(ex_df1$Label)
stat.test <-
log_df1 %>%
group_by(variable) %>%
get_summary_stats() %>%
wilcox_test(value ~ Label) %>%
adjust_pvalue(method="fdr") %>%
add_significance("p.adj")
?get_summary_stats
stat.test <-
log_df1 %>%
group_by(variable) %>%
get_summary_stats(value ~ Label,type = "median") %>%
wilcox_test(value ~ Label) %>%
adjust_pvalue(method="fdr") %>%
add_significance("p.adj")
stat.test <-
log_df1 %>%
group_by(variable) %>%
wilcox_test(value ~ Label) %>%
adjust_pvalue(method="fdr") %>%
add_significance("p.adj")
sta_lst_sig <- stat.test
sums <-
log_df1 %>%
group_by(variable,Label) %>%
get_summary_stats(value,type = "median")
log_df1
log_df1 %>%
group_by(variable,Label)
sums <-
log_df1 %>%
group_by(variable,Label) %>%
get_summary_stats(value,type = "common")
log_df1
log_df1 %>%
group_by(variable,Label) %>%
get_summary_stats(value,type = "common")
sums <-
log_df1 %>%
group_by(Label,variable) %>%
get_summary_stats(value,type = "common")
log_df1
log_df1 <- factor(log_df1$Label)
log_df1 %>%
group_by(variable,Label) %>%
get_summary_stats(value,type = "common")
log_df1
lcp3 <- c("#FF3F38","#B25D91","#95C65C")
df_norm_lab4 <- df_norm_lab
df_norm_lab4$Label <- ifelse(df_norm_lab4$Label==2,10,df_norm_lab4$Label)
df_norm_lab4$Label <- ifelse(df_norm_lab4$Label==12,8,df_norm_lab4$Label)
df_norm_lab4 <- rownames_to_column(df_norm_lab4)
log_df1 <- melt(df_norm_lab4, id.vars=c("rowname","Label"))
log_df1$Label <- factor(log_df1$Label)
stat.test <-
log_df1 %>%
group_by(variable) %>%
wilcox_test(value ~ Label) %>%
adjust_pvalue(method="fdr") %>%
add_significance("p.adj")
sta_lst_sig <- stat.test
sums <-
log_df1 %>%
group_by(variable,Label) %>%
get_summary_stats(value,type = "common")
log_df1
sums <-
log_df1 %>%
group_by(variable,Label) %>%
get_summary_stats(type = "common")
log_df1 %>%
group_by(variable,Label)
sums <-
log_df1 %>%
group_by(variable,Label) %>%
get_summary_stats()
log_df1 %>%
group_by(Label) %>%
get_summary_stats()
sums <-
log_df1 %>%
group_by(Label,variable) %>%
get_summary_stats()
log_df1 %>%
group_by(Label,variable)
sums <-
log_df1 %>%
group_by(Label,variable) %>%
get_summary_stats(value)
sums <-
log_df1 %>%
group_by(variable) %>%
get_summary_stats(value)
log_df1 %>%
group_by(Label,variable) %>%
get_summary_stats(value) %>%
unnest(names_repair = "unique")
log_df1
sums <-
log_df1 %>%
group_by(Label,variable) %>%
get_summary_stats(value) %>%
unnest(cols = variable,names_repair = "unique")
sums <-
log_df1 %>%
group_by(Label,variable) %>%
get_summary_stats(value) %>%
unnest(cols = unique(variable))
log_df1 %>%
group_by(Label,variable) %>%
median(value)
log_df1
sums <-
log_df1 %>%
group_by(Label,variable) %>%
median()
log_df1
View(log_df1)
?summarise
medians <- log_df1 %>%
group_by(variable, Label) %>%
summarise(Median = median(value))
medians
medians <- log_df1 %>%
group_by(variable, Label) %>%
summarise(Median = median(2^(value)))
medians
2^(log(3))
2^(log2(3))
2^(log2(0.259))
View(medians)
medians
?spread
spread(log_df1)
pivot_wider(log_df1)
?pivot_wider
log_df1
pivot_wider(log_df1,id_cols =c("ID","rowname"))
pivot_wider(log_df1,id_cols =c("rowname"),names_from = "ID")
pivot_wider
log_df1
pivot_wider(log_df1,id_cols =c("Label"),names_from = "rowname")
pivot_wider(log_df1,id_cols =c("rowname","Label"),names_from = "variable")
medians
pivot_wider(medians,id_cols ="Label",names_from = "variable")
medians
pivot_wider(medians)
medians
pivot_wider(medians,id_cols ="variable",names_from = "variable")
medians
pivot_wider(medians,values_from = "Median",names_from = "variable")
medians
pivot_wider(medians,values_from = "Median",names_from = "variable")
wide_meds <- pivot_wider(medians,values_from = "Median",names_from = "variable")
