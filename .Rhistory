mat_allg <- as.matrix(df_metg)
lab <- data.frame(as.factor(mat_allg[1,]))
lab$as.factor.mat_allg.1.... <- gsub(8,"Hyperglutamatergic     ",lab$as.factor.mat_allg.1....)
lab$as.factor.mat_allg.1.... <- gsub(1,"Control",lab$as.factor.mat_allg.1....)
colnames(lab)<-"Label"
lab$Label<- factor(lab$Label,levels = c("Control","Hyperglutamatergic     ","Hypoglutamatergic     "),ordered = TRUE)
mat_allg <- apply(mat_allg[-1,],c(1,2),as.numeric)
lc <- c("#95C65C","#FF3F38","#B25D91")
names(lc) <-  levels(lab$Label)
lc <- list(Label = lc)
p7 <- pheatmap(mat_allg, annotation = lab,clustering_method = "ward.D2",fontsize = 12,show_colnames = TRUE,show_rownames = TRUE, border_color = NA, annotation_colors = lc, fontsize_col = 12, color = colorRampPalette(c("blue","red"))(100), cluster_rows = TRUE,scale = "row",legend = TRUE, annotation_legend = FALSE, cellwidth = 15, cellheight = 10)
p7 <- wrap_elements(as.grob(p7))
ggsave(file=here("paper/Figures/fig_2H.png"),p7,dpi = 500,width = 4,scale=2, height = 3, units = "in")
patchhc2 <- p6+p7+plot_annotation(tag_levels = list(c("G","H")))
ggsave(file=here("paper/Figures/fig_2G_H.png"),patchhc2,dpi = 1000,scale=1.5,width = 10, height = 3,units = "in")
pat_char <-  read.csv(here("metadata/patient_characteristics.csv"),sep=";")
# Checking for effect medications
# pat_contrl <-  subset(pat_char,!(pat_char$Disease=="Control"))
pat_ctrl_meds <- pat_char[,c("ID","Medications")]
meds_lst <- strsplit(pat_ctrl_meds$Medications,",")
names(meds_lst) <- pat_ctrl_meds$ID
meds_lst <- lapply(meds_lst, function(x) toupper(str_squish(x)))
meds_lst <- lapply(meds_lst, data.frame)
meds_lst <- lapply(meds_lst, function(x) setNames(x, "Medication"))
meds_lst <- lapply(names(meds_lst), function(x) meds_lst[[x]] %>%
mutate(value = 1, id = x, Medication=factor(Medication)))
meds_lst <- bind_rows(meds_lst)
prop_meds <- data.frame(table(meds_lst$Medication))
prop_meds <- subset(prop_meds, Freq>3)
colnames(prop_meds) <- c("Medication","Freq")
one_hot_encoded <- meds_lst %>%
pivot_wider(names_from = Medication, values_from = value, values_fill = 0)
one_hot_encoded <- one_hot_encoded[,colnames(one_hot_encoded)%in%c("id",as.character(prop_meds$Medication))]
df_norm_meds <- df_norm_lab[,-1]
df_norm_meds <- rownames_to_column(df_norm_meds,var = "id")
df_norm_meds$id <- make.names(df_norm_meds$id)
med.test <- list()
for (i in prop_meds$Medication) {
df_norm_meds_i <- merge(one_hot_encoded[,c("id",i)],df_norm_meds)
long_med <- melt(df_norm_meds_i, id.vars=c("id",i))
colnames(long_med) <- c("id",make.names(i),"variable","value")
med.test[[i]] <-
long_med %>%
group_by(variable) %>%
wilcox_test(as.formula(paste0("value ~ ",make.names(i)))) %>%
adjust_pvalue(method="fdr") %>%
add_significance("p.adj")
}
# Checking effect of age
pat_contrl <-  pat_char
pat_contrl <-  pat_contrl[order(pat_contrl$ID),]
# pat_contrl <-  subset(pat_contrl,!(pat_contrl$Disease=="Control"))
df_norm_age <- df_norm_lab
df_norm_age <- rownames_to_column(df_norm_age,var = "ID")
df_norm_age <- subset(df_norm_age, make.names(df_norm_age$ID)%in%pat_contrl$ID)
df_norm_age$Label <- pat_contrl$Age
df_norm_age <- df_norm_age[complete.cases(df_norm_age),]
log_df_age <- melt(df_norm_age, id.vars = c("ID","Label"))
cor_age <- log_df_age %>%
group_by(variable) %>%
cor_test(Label, value, method= "spearman")  %>%
adjust_pvalue(method = "fdr") %>%
add_significance("p.adj")
# Checking effect of sex
pat_contrl <-  read.csv(here("metadata/patient_characteristics.csv"),sep=";")
pat_contrl <-  pat_contrl[,-7]
pat_contrl <-  pat_contrl[order(pat_contrl$ID),]
df_norm_sex <- df_norm_lab
df_norm_sex <- rownames_to_column(df_norm_sex,var = "ID")
df_norm_sex <- subset(df_norm_sex, make.names(df_norm_sex$ID)%in%pat_contrl$ID)
df_norm_sex$Label <- factor(pat_contrl$Sex)
df_norm_sex <- df_norm_sex[complete.cases(df_norm_sex),]
log_df_sex <- melt(df_norm_sex, id.vars = c("ID","Label"))
comp_sex <- log_df_sex %>%
group_by(variable) %>%
wilcox_test(as.formula(value ~ Label), p.adjust.method = NULL) %>%
adjust_pvalue(method = "fdr") %>%
add_significance("p.adj")
rownames(df_norm_sex) <- df_norm_sex$ID
oplsda_sex <- opls(df_norm_sex[,-c(1,2)],as.factor(df_norm_sex$Label),orthoI = 1,predI=1,scaleC = "center", permI = 1000)
sx <- factor(df_norm_sex$Label)
opsx <- data.frame("lab"=sx,"x"=oplsda_sex@scoreMN,"y"=oplsda_sex@orthoScoreMN)
opsxplot <- opsx %>%
ggplot(aes(x=p1,y=o1,color=lab)) +
geom_point(size=3) +
stat_ellipse(geom = "polygon",
aes(fill = lab),
alpha = 0.25,
level = 0.8) +
coord_fixed(xlim = c(-10,10),ylim=c(-5,5)) +
theme_bw(base_size = 15) +
scale_color_manual(values=c("pink","lightblue"),labels=c("F","M"),drop = FALSE) +
scale_fill_manual(values=c("pink","lightblue"),labels=c("F","M"),drop = FALSE) +
theme(legend.title = element_blank()) +
geom_vline(xintercept=0) +
geom_hline(yintercept = 0)
ggsave(file=here("paper/Figures/OPLSDA_sex.png"),opsxplot, dpi = 500, width = 8, height = 4)
library(writexl)
write_xlsx(
med.test,
path = here("paper/Tables/comparing_medications.xlsx"),
col_names = TRUE,
format_headers = TRUE,
use_zip64 = FALSE
)
write_xlsx(cor_age,path = here("paper/Tables/correlation_age.xlsx"))
write_xlsx(comp_sex,path = here("paper/Tables/comparing_sex.xlsx"))
cat(sels$Hypoglutamatergic, sep = "\n")
View(paths_df)
?wilcox_test
lcp3 <- c("#FF3F38","#B25D91","#95C65C")
df_norm_lab4 <- df_norm_lab
df_norm_lab4$Label <- ifelse(df_norm_lab4$Label==2,10,df_norm_lab4$Label)
df_norm_lab4$Label <- ifelse(df_norm_lab4$Label==12,8,df_norm_lab4$Label)
df_norm_lab4 <- rownames_to_column(df_norm_lab4)
log_df1 <- melt(df_norm_lab4, id.vars=c("rowname","Label"))
log_df1$Label <- factor(log_df1$Label)
stat.test <-
log_df1 %>%
group_by(variable) %>%
wilcox_test(value ~ Label, p.adjust.method = NULL, detailed = TRUE) %>%
adjust_pvalue(method="fdr") %>%
add_significance("p.adj")
sta_lst_sig <- stat.test
?wilcox_test
medians <- log_df1 %>%
group_by(variable, Label) %>%
summarise(Median = median(2^(value)))
wide_meds <- pivot_wider(medians,values_from = "Median",names_from = "variable")
View(sta_lst_sig)
plot(log_df_age$Label, log_df_age$value)
log_df_age$Label
log_df_age
df_norm_age
log_df_age %>%
ggplot(aes(x=Label, y=value, color=variable))
log_df_age
log_df_age %>%
ggplot(aes(x=Label, y=value))
log_df_age
log_df_age %>%
ggplot(aes(x=Label, y=value)) +
geom_point()
log_df_age %>%
ggplot(aes(x=value, y=Label)) +
geom_point()
log_df_age %>%
ggplot(aes(x=value, y=Label, color=variable)) +
geom_point()
log_df_age %>%
ggplot(aes(x=value, y=as.double(Label), color=variable)) +
geom_point()
log_df_age %>%
ggplot(aes(x=as.double(Label), y=value, color=variable)) +
geom_point()
log_df_age %>%
ggplot(aes(x=Label, y=value, group=variable)) +
geom_point()
log_df_age %>%
group_by(variable) %>%
ggplot(aes(x=Label, y=value, color=variable)) +
geom_point()
log_df_age %>%
ggplot(aes(x=Label, y=value, color=variable)) +
ggscatter()
?ggscatter
log_df_age %>%
ggplot(aes(x=Label, y=value, color=variable, group=variable)) +
geom_point()
log_df_age %>%
ggplot(aes(x=Label, y=value, color=variable, group=interaction(variable, value))) +
geom_point() +
geom_line()
log_df_age %>%
ggplot(aes(x=Label, y=value, color=variable, group=interaction(Label,variable))) +
geom_point() +
geom_line()
colnames(df_norm_age)
# for (i in colnames(df_norm_age))
log_df_age %>%
ggplot(aes(x=Label, y=value, color=variable, group=interaction(ID,variable))) +
geom_point() +
geom_line()
# for (i in colnames(df_norm_age))
log_df_age %>%
ggplot(aes(x=Label, y=value, color=variable, group=ID)) +
geom_point() +
geom_line()
df_norm_age %>%
ggplot(aes(x=Label, y=i, color=ID)) +
geom_point() +
geom_line()
for (i in colnames(df_norm_age)) {
df_norm_age %>%
ggplot(aes(x=Label, y=i, color=ID)) +
geom_point() +
geom_line()
}
for (i in colnames(df_norm_age)) {
p = df_norm_age %>%
ggplot(aes(x=Label, y=i, color=ID)) +
geom_point() +
geom_line()
print(p)
}
for (i in colnames(df_norm_age)) {
p = df_norm_age %>%
ggplot(aes(x=Label, y=df_norm_age[[i]], color=ID)) +
geom_point() +
geom_line()
print(p)
}
colnames(df_norm_age)
for (i in colnames(df_norm_age)[-c(1,2)]) {
p = df_norm_age %>%
ggplot(aes(x=Label, y=df_norm_age[[i]])) +
geom_point() +
geom_line() +
ylab(paste0("log2 uM ",i))
print(p)
}
df_norm_age
for (i in colnames(df_norm_age)[-c(1,2)]) {
p = df_norm_age %>%
ggplot(aes(x=Label, y=df_norm_age[[i]])) +
geom_point() +
geom_line() +
ylab(paste0("log2 uM ",i)) +
xlab("Age (years)")
print(p)
}
for (i in colnames(df_norm_age)[-c(1,2)]) {
p = df_norm_age %>%
ggplot(aes(x=Label, y=df_norm_age[[i]])) +
geom_text(aes(label=ID)) +
geom_line() +
ylab(paste0("log2 uM ",i)) +
xlab("Age (years)")
print(p)
}
df_norm_age
cor_plots <- list()
for (i in colnames(df_norm_age)[-c(1,2)]) {
cor_plots[[i]] = df_norm_age %>%
ggplot(aes(x=Label, y=df_norm_age[[i]])) +
geom_text(aes(label=ID)) +
geom_line() +
ylab(paste0("log2 uM ",i)) +
xlab("Age (years)")
}
cor_plots
cor_plots <- list()
for (i in colnames(df_norm_age)[-c(1,2)]) {
cor_plots[[i]] <- df_norm_age %>%
ggplot(aes(x=Label, y=df_norm_age[[i]])) +
geom_text(aes(label=ID)) +
geom_line() +
ylab(paste0("log2 uM ",i)) +
xlab("Age (years)")
}
cor_plots
cor_plots <- list()
for (i in colnames(df_norm_age)[-c(1,2)]) {
cor_plots[[i]] <- df_norm_age %>%
ggplot(aes(x=Label, y=df_norm_age[[i]])) +
geom_text(aes(label=ID)) +
geom_line() +
ylab(paste0("log2 uM ",i)) +
xlab("Age (years)")
}
cor_plots
df_norm_age %>%
ggplot(aes(x=Label, y=colnames(.))) +
geom_text(aes(label=ID)) +
geom_line() +
# ylab(paste0("log2 uM ",i)) +
xlab("Age (years)")
for (i in colnames(df_norm_age)[-c(1,2)]) {
p = df_norm_age %>%
ggplot(aes(x=Label, y=df_norm_age[[i]])) +
geom_text(aes(label=ID)) +
geom_line() +
ylab(paste0("log2 uM ",i)) +
xlab("Age (years)")
print(p)
}
p = df_norm_age %>%
ggplot(aes(x=Label, y=df_norm_age[[i]])) +
# geom_text(aes(label=ID)) +
geom_point() +
geom_line() +
ylab(paste0("log2 uM ",i)) +
xlab("Age (years)")
for (i in colnames(df_norm_age)[-c(1,2)]) {
p = df_norm_age %>%
ggplot(aes(x=Label, y=df_norm_age[[i]])) +
# geom_text(aes(label=ID)) +
geom_point() +
geom_line() +
ylab(paste0("log2 uM ",i)) +
xlab("Age (years)")
print(p)
}
med.test
for (i in colnames(df_norm_age)[-c(1,2)]) {
p = df_norm_age %>%
ggplot(aes(x=Label, y=df_norm_age[[i]])) +
# geom_text(aes(label=ID)) +
geom_point() +
geom_line() +
ylab(paste0("log2 uM ",i)) +
xlab("Age (years)")
print(p)
cor_plots <- p
}
for (i in colnames(df_norm_age)[-c(1,2)]) {
p = df_norm_age %>%
ggplot(aes(x=Label, y=df_norm_age[[i]])) +
# geom_text(aes(label=ID)) +
geom_point() +
geom_line() +
ylab(paste0("log2 uM ",i)) +
xlab("Age (years)")
print(p)
cor_plots[[i]] <- p
}
cor_plots
cor_plots <- list(colnames(df_norm_age)[-c(1,2)])
for (i in colnames(df_norm_age)[-c(1,2)]) {
p = df_norm_age %>%
ggplot(aes(x=Label, y=df_norm_age[[i]])) +
# geom_text(aes(label=ID)) +
geom_point() +
geom_line() +
ylab(paste0("log2 uM ",i)) +
xlab("Age (years)")
print(p)
cor_plots[[i]] <- p
}
cor_plots
cor_plots <- list()
for (i in colnames(df_norm_age)[-c(1,2)]) {
p = df_norm_age %>%
ggplot(aes(x=Label, y=df_norm_age[[i]])) +
# geom_text(aes(label=ID)) +
geom_point() +
geom_line() +
ylab(paste0("log2 uM ",i)) +
xlab("Age (years)")
print(p)
cor_plots[i] <- p
}
cor_plots
cor_plots <- list()
for (i in colnames(df_norm_age)[-c(1,2)]) {
cor_plots[[i]] <- df_norm_age %>%
ggplot(aes(x=Label, y=df_norm_age[[i]])) +
# geom_text(aes(label=ID)) +
geom_point() +
geom_line() +
ylab(paste0("log2 uM ",i)) +
xlab("Age (years)")
}
cor_plots
for (i in colnames(df_norm_age)[-c(1,2)]) {
cor_plots[[i]] <-
ggplot(data=df_norm_age, aes(x=Label, y=df_norm_age[[i]])) +
# geom_text(aes(label=ID)) +
geom_point() +
geom_line() +
ylab(paste0("log2 uM ",i)) +
xlab("Age (years)")
}
cor_plots
cor_plots <- as.list(colnames(df_norm_age)[-c(1,2)])
for (i in colnames(df_norm_age)[-c(1,2)]) {
cor_plots[[i]] <-
ggplot(data=df_norm_age, aes(x=Label, y=df_norm_age[[i]])) +
# geom_text(aes(label=ID)) +
geom_point() +
geom_line() +
ylab(paste0("log2 uM ",i)) +
xlab("Age (years)")
}
cor_plots
for (i in colnames(df_norm_age)[-c(1,2)]) {
p = df_norm_age %>%
ggplot(aes(x=Label, y=df_norm_age[[i]])) +
geom_text(aes(label=ID)) +
geom_line() +
ylab(paste0("log2 uM ",i)) +
xlab("Age (years)")
print(p)
}
cor_lst <- list()
for (i in colnames(df_norm_age)[-c(1,2)]) {
p = ggplot(data=df_norm_age,aes(x=Label, y=df_norm_age[[i]])) +
geom_text(aes(label=ID)) +
geom_line() +
ylab(paste0("log2 uM ",i)) +
xlab("Age (years)")
cor_lst[[i]] <- p
}
cor_lst
cor.plot <- function(df,i) {
p = ggplot(data=df,aes(x=Label, y=i)) +
geom_text(aes(label=ID)) +
geom_line() +
ylab(paste0("log2 uM ",i)) +
xlab("Age (years)")
return(p)
}
cor.plot
lapply(colnames(df_norm_age)[-c(1,2)], function(x) cor.plot, df_norm_age, x)
lapply(colnames(df_norm_age)[-c(1,2)], function(x) cor.plot(df_norm_age, x))
df_norm_age
ggplot(data=df_norm_age,aes(x=Label, y=`L-Citrulline`)) +
geom_text(aes(label=ID)) +
geom_line() +
ylab(paste0("log2 uM ",`L-Citrulline`)) +
xlab("Age (years)")
ggplot(data=df_norm_age,aes(x=Label, y=L-Citrulline)) +
geom_text(aes(label=ID)) +
geom_line() +
ylab(paste0("log2 uM ",`L-Citrulline`)) +
xlab("Age (years)")
colnames(df_norm_age)
ggplot(data=df_norm_age,aes(x=Label, y=L-Citrulline)) +
geom_text(aes(label=ID)) +
geom_line() +
ylab(paste0("log2 uM ",L-Citrulline)) +
xlab("Age (years)")
ggplot(data=df_norm_age,aes(x=Label, y="L-Citrulline")) +
geom_text(aes(label=ID)) +
geom_line() +
ylab(paste0("log2 uM ","L-Citrulline")) +
xlab("Age (years)")
ggplot(data=df_norm_age,aes(x=df_norm_age$Label, y=df_norm_age$`L-Citrulline`)) +
geom_text(aes(label=ID)) +
geom_line() +
ylab(paste0("log2 uM ","L-Citrulline")) +
xlab("Age (years)")
cor.plot <- function(df,i) {
p = ggplot(data=df,aes(x=df$Label, y=df[[i]])) +
geom_text(aes(label=ID)) +
geom_line() +
ylab(paste0("log2 uM ",i)) +
xlab("Age (years)")
return(p)
}
lapply(colnames(df_norm_age)[-c(1,2)], function(x) cor.plot(df_norm_age, x))
cor_plot_lst <- lapply(colnames(df_norm_age)[-c(1,2)], function(x) cor.plot(df_norm_age, x))
cor_plot_lst
names(cor_plot_lst) <- colnames(df_norm_age)[-c(1,2)]
ggarrange(cor_plot_lst)
?ggarrange
ggarrange(plotlist=cor_plot_lst)
View(cor_age)
ggarrange(plotlist=cor_plot_lst[1:10])
p = ggplot(data=df,aes(x=df$Label, y=df[[i]])) +
# geom_text(aes(label=ID)) +
geom_point() +
geom_line() +
ylab(paste0("log2 uM ",i)) +
xlab("Age (years)")
cor.plot <- function(df,i) {
p = ggplot(data=df,aes(x=df$Label, y=df[[i]])) +
# geom_text(aes(label=ID)) +
geom_point() +
geom_line() +
ylab(paste0("log2 uM ",i)) +
xlab("Age (years)")
return(p)
}
cor_plot_lst <- lapply(colnames(df_norm_age)[-c(1,2)], function(x) cor.plot(df_norm_age, x))
names(cor_plot_lst) <- colnames(df_norm_age)[-c(1,2)]
ggarrange(plotlist=cor_plot_lst[1:10])
ggarrange(plotlist=cor_plot_lst[21:29])
cor_age <- log_df_age %>%
group_by(variable) %>%
cor_test(Label, value, method= "spearman")  %>%
adjust_pvalue(method = "fdr") %>%
add_significance("p.adj") %>%
cor_plot()
cor_age
cor_age <- log_df_age %>%
group_by(variable) %>%
cor_mat(Label, value, method= "spearman")  %>%
adjust_pvalue(method = "fdr") %>%
add_significance("p.adj")
cor_age <- log_df_age %>%
group_by(variable) %>%
cor_test(Label, value, method= "spearman")  %>%
adjust_pvalue(method = "fdr") %>%
add_significance("p.adj")
install.packages("correlation")
colnames(df_norm_age)
plot(cor_test(df_norm_age, "Label", "Kynurenine"))
library(correlation)
plot(correlation::cor_test(df_norm_age, "Label", "Kynurenine"))
plot(correlation::cor_test(df_norm_age, "Label", "Kynurenine"))
plot(correlation(df_norm_age, "Label", "Kynurenine"))
correlation(df_norm_age, "Label", "Kynurenine")
res <- correlation(df_norm_age, "Label", "Kynurenine")
res
res <- correlation(df_norm_age)
View(res)
plot(correlation::cor_test(df_norm_age, "Label", "Kynurenine"))
plot(correlation::cor_test(df_norm_age, "Label", "
Malic acid"))
plot(correlation::cor_test(df_norm_age, "Label", "	Malic acid"))
plot(correlation::cor_test(df_norm_age, "Label", "Malic acid"))
